(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44869a72"],{"0578":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("14d9");var s=r("fa73");class n{constructor(e){this._hash=Object.create(null),this._renderer=e}contextChange(e){this._gpu=e}getBindGroup(e,t,r){e._updateKey();const s=this._hash[e._key]||this._createBindGroup(e,t,r);return s}_createBindGroup(e,t,r){const s=this._gpu.device,n=t.layout[r],i=[],a=this._renderer;for(const d in n){var o;const t=null!==(o=e.resources[d])&&void 0!==o?o:e.resources[n[d]];let r;if("uniformGroup"===t._resourceType){const e=t;a.ubo.updateUniformGroup(e);const s=e.buffer;r={buffer:a.buffer.getGPUBuffer(s),offset:0,size:s.descriptor.size}}else if("buffer"===t._resourceType){const e=t;r={buffer:a.buffer.getGPUBuffer(e),offset:0,size:e.descriptor.size}}else if("bufferResource"===t._resourceType){const e=t;r={buffer:a.buffer.getGPUBuffer(e.buffer),offset:e.offset,size:e.size}}else if("textureSampler"===t._resourceType){const e=t;r=a.texture.getGpuSampler(e)}else if("textureSource"===t._resourceType){const e=t;r=a.texture.getGpuSource(e).createView({})}i.push({binding:n[d],resource:r})}const u=a.shader.getProgramData(t).bindGroups[r],c=s.createBindGroup({layout:u,entries:i});return this._hash[e._key]=c,c}destroy(){for(const e of Object.keys(this._hash))this._hash[e]=null;this._hash=null,this._renderer=null}}n.extension={type:[s["a"].WebGPUSystem],name:"bindGroup"}},"0696":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("14d9");var s=r("fa73"),n=r("2004");class i{constructor(){this._gpuBuffers=Object.create(null),this._managedBuffers=[]}contextChange(e){this._gpu=e}getGPUBuffer(e){return this._gpuBuffers[e.uid]||this.createGPUBuffer(e)}updateBuffer(e){const t=this._gpuBuffers[e.uid]||this.createGPUBuffer(e),r=e.data;return e._updateID&&r&&(e._updateID=0,this._gpu.device.queue.writeBuffer(t,0,r.buffer,0,(e._updateSize||r.byteLength)+3&-4)),t}destroyAll(){for(const e in this._gpuBuffers)this._gpuBuffers[e].destroy();this._gpuBuffers={}}createGPUBuffer(e){this._gpuBuffers[e.uid]||(e.on("update",this.updateBuffer,this),e.on("change",this.onBufferChange,this),e.on("destroy",this.onBufferDestroy,this));const t=this._gpu.device.createBuffer(e.descriptor);return e._updateID=0,e.data&&(Object(n["a"])(e.data.buffer,t.getMappedRange()),t.unmap()),this._gpuBuffers[e.uid]=t,this._managedBuffers.push(e),t}onBufferChange(e){const t=this._gpuBuffers[e.uid];t.destroy(),e._updateID=0,this._gpuBuffers[e.uid]=this.createGPUBuffer(e)}onBufferDestroy(e){this._managedBuffers.splice(this._managedBuffers.indexOf(e),1),this._destroyBuffer(e)}destroy(){this._managedBuffers.forEach(e=>this._destroyBuffer(e)),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(e){const t=this._gpuBuffers[e.uid];t.destroy(),e.off("update",this.updateBuffer,this),e.off("change",this.onBufferChange,this),e.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[e.uid]=null}}i.extension={type:[s["a"].WebGPUSystem],name:"buffer"}},"0f0d":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r("91be"),n=r("f08f"),i=r("d65f");function a(e){return Object(s["a"])(e,"uboWgsl",i["a"],n["b"])}},"190b":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("fa73");class n{constructor(e){this._renderer=e}async init(e){return this._initPromise||(this._initPromise=this._createDeviceAndAdaptor(e).then(e=>{this.gpu=e,this._renderer.runners.contextChange.emit(this.gpu)})),this._initPromise}contextChange(e){this._renderer.gpu=e}async _createDeviceAndAdaptor(e){const t=await navigator.gpu.requestAdapter({powerPreference:e.powerPreference,forceFallbackAdapter:e.forceFallbackAdapter}),r=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(e=>t.features.has(e)),s=await t.requestDevice({requiredFeatures:r});return{adapter:t,device:s}}destroy(){this.gpu=null,this._renderer=null}}n.extension={type:[s["a"].WebGPUSystem],name:"device"},n.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1}},"1bb9":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var s=r("fa73"),n=r("2714"),i=r("8cbc"),a=r("39bc"),o=r("3f58"),u=r("dcdc"),c=r("cb48"),d=r("af3f"),h=r("2a40");class l{init(){const e=Object(i["b"])({name:"mesh",bits:[a["a"],u["a"],o["a"]]});this._shader=new c["a"]({gpuProgram:e,resources:{uTexture:d["a"].EMPTY._source,uSampler:d["a"].EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new n["a"]}}}})}execute(e,t){const r=e.renderer;let s=t._shader;if(s){if(!s.gpuProgram)return void Object(h["a"])("Mesh shader has no gpuProgram",t.shader)}else s=this._shader,s.resources.uTexture=t.texture.source,s.resources.uSampler=t.texture.source.style,s.resources.textureUniforms.uniforms.uTextureMatrix=t.texture.textureMatrix.mapCoord;const n=s.gpuProgram;if(n.autoAssignGlobalUniforms&&(s.groups[0]=r.globalUniforms.bindGroup),n.autoAssignLocalUniforms){const t=e.localUniforms;s.groups[1]=r.renderPipes.uniformBatch.getUniformBindGroup(t,!0)}r.encoder.draw({geometry:t._geometry,shader:s,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}l.extension={type:[s["a"].WebGPUPipesAdaptor],name:"mesh"}},"1f8f":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var s=r("fa73"),n=r("fe508"),i=r("ee68"),a=r("0f0d");class o extends n["a"]{constructor(){super({createUboElements:i["b"],generateUboSync:a["a"]})}}o.extension={type:[s["a"].WebGPUSystem],name:"ubo"}},2954:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r("fa73"),n=r("eb07"),i=r("df2c");class a extends n["a"]{constructor(e){super(e),this.adaptor=new i["a"],this.adaptor.init(e,this)}}a.extension={type:[s["a"].WebGPUSystem],name:"renderTarget"}},"2e80":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("fa73");class n{constructor(e){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=e}renderStart(){this.commandFinished=new Promise(e=>{this._resolveCommandFinished=e}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(e){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(e.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(e){this.renderPassEncoder.setViewport(e.x,e.y,e.width,e.height,0,1)}setPipelineFromGeometryProgramAndState(e,t,r,s){const n=this._renderer.pipeline.getPipeline(e,t,r,s);this.setPipeline(n)}setPipeline(e){this._boundPipeline!==e&&(this._boundPipeline=e,this.renderPassEncoder.setPipeline(e))}_setVertexBuffer(e,t){this._boundVertexBuffer[e]!==t&&(this._boundVertexBuffer[e]=t,this.renderPassEncoder.setVertexBuffer(e,this._renderer.buffer.updateBuffer(t)))}_setIndexBuffer(e){if(this._boundIndexBuffer===e)return;this._boundIndexBuffer=e;const t=2===e.data.BYTES_PER_ELEMENT?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(e),t)}resetBindGroup(e){this._boundBindGroup[e]=null}setBindGroup(e,t,r){if(this._boundBindGroup[e]===t)return;this._boundBindGroup[e]=t,t._touch(this._renderer.textureGC.count);const s=this._renderer.bindGroup.getBindGroup(t,r,e);this.renderPassEncoder.setBindGroup(e,s)}setGeometry(e){for(const t in e.attributes){const r=e.attributes[t];this._setVertexBuffer(r.location,r.buffer)}e.indexBuffer&&this._setIndexBuffer(e.indexBuffer)}_setShaderBindGroups(e,t){for(const r in e.groups){const s=e.groups[r];t||this._syncBindGroup(s),this.setBindGroup(r,s,e.gpuProgram)}}_syncBindGroup(e){for(const t in e.resources){const r=e.resources[t];r.isUniformGroup&&this._renderer.ubo.updateUniformGroup(r)}}draw(e){const{geometry:t,shader:r,state:s,topology:n,size:i,start:a,instanceCount:o,skipSync:u}=e;this.setPipelineFromGeometryProgramAndState(t,r.gpuProgram,s,n),this.setGeometry(t),this._setShaderBindGroups(r,u),t.indexBuffer?this.renderPassEncoder.drawIndexed(i||t.indexBuffer.data.length,o||t.instanceCount,a||0):this.renderPassEncoder.draw(i||t.getSize(),o||t.instanceCount,a||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){const e=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(e);const t=this._boundPipeline,r={...this._boundVertexBuffer},s=this._boundIndexBuffer,n={...this._boundBindGroup};this._clearCache();const i=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(i.x,i.y,i.width,i.height,0,1),this.setPipeline(t);for(const a in r)this._setVertexBuffer(a,r[a]);for(const a in n)this.setBindGroup(a,n[a],null);this._setIndexBuffer(s)}_clearCache(){for(let e=0;e<16;e++)this._boundBindGroup[e]=null,this._boundVertexBuffer[e]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(e){this._gpu=e}}n.extension={type:[s["a"].WebGPUSystem],name:"encoder",priority:1}},"30b4":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("fa73");class n{constructor(){this._gpuProgramData=Object.create(null)}contextChange(e){this._gpu=e}getProgramData(e){return this._gpuProgramData[e._layoutKey]||this._createGPUProgramData(e)}_createGPUProgramData(e){const t=this._gpu.device,r=e.gpuLayout.map(e=>t.createBindGroupLayout({entries:e})),s={bindGroupLayouts:r};return this._gpuProgramData[e._layoutKey]={bindGroups:r,pipeline:t.createPipelineLayout(s)},this._gpuProgramData[e._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}n.extension={type:[s["a"].WebGPUSystem],name:"shader"}},"3d33":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));r("14d9"),r("907a"),r("986a"),r("1d02"),r("3c5d"),r("1b3b"),r("3d71"),r("c6e3");var s=r("536a"),n=r("fa73"),i=r("6419"),a=r("45d1c"),o=r("e3db"),u=r("969b"),c=r("4c24"),d=r("c8c0"),h=r("ddea");class l{constructor(e){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:c["a"],buffer:o["a"],video:d["a"],compressed:u["b"]},this._renderer=e}contextChange(e){this._gpu=e}initSource(e){if(e.autoGenerateMipmaps){const t=Math.max(e.pixelWidth,e.pixelHeight);e.mipLevelCount=Math.floor(Math.log2(t))+1}let t=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;"compressed"!==e.uploadMethodId&&(t|=GPUTextureUsage.RENDER_ATTACHMENT,t|=GPUTextureUsage.COPY_SRC);const r=u["a"][e.format]||{blockBytes:4,blockWidth:1,blockHeight:1},s=Math.ceil(e.pixelWidth/r.blockWidth)*r.blockWidth,n=Math.ceil(e.pixelHeight/r.blockHeight)*r.blockHeight,i={label:e.label,size:{width:s,height:n},format:e.format,sampleCount:e.sampleCount,mipLevelCount:e.mipLevelCount,dimension:e.dimension,usage:t},a=this._gpu.device.createTexture(i);return this._gpuSources[e.uid]=a,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceResize,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),a}onSourceUpdate(e){const t=this.getGpuSource(e);t&&(this._uploads[e.uploadMethodId]&&this._uploads[e.uploadMethodId].upload(e,t,this._gpu),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e))}onSourceUnload(e){const t=this._gpuSources[e.uid];t&&(this._gpuSources[e.uid]=null,t.destroy())}onUpdateMipmaps(e){this._mipmapGenerator||(this._mipmapGenerator=new h["a"](this._gpu.device));const t=this.getGpuSource(e);this._mipmapGenerator.generateMipmap(t)}onSourceDestroy(e){e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("destroy",this.onSourceDestroy,this),e.off("resize",this.onSourceResize,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}onSourceResize(e){const t=this._gpuSources[e.uid];t?t.width===e.pixelWidth&&t.height===e.pixelHeight||(this._textureViewHash[e.uid]=null,this._bindGroupHash[e.uid]=null,this.onSourceUnload(e),this.initSource(e)):this.initSource(e)}_initSampler(e){return this._gpuSamplers[e._resourceId]=this._gpu.device.createSampler(e),this._gpuSamplers[e._resourceId]}getGpuSampler(e){return this._gpuSamplers[e._resourceId]||this._initSampler(e)}getGpuSource(e){return this._gpuSources[e.uid]||this.initSource(e)}getTextureBindGroup(e){var t;return null!==(t=this._bindGroupHash[e.uid])&&void 0!==t?t:this._createTextureBindGroup(e)}_createTextureBindGroup(e){const t=e.source,r=t.uid;return this._bindGroupHash[r]=new a["a"]({0:t,1:t.style}),this._bindGroupHash[r]}getTextureView(e){var t;const r=e.source;return null!==(t=this._textureViewHash[r.uid])&&void 0!==t?t:this._createTextureView(r)}_createTextureView(e){return this._textureViewHash[e.uid]=this.getGpuSource(e).createView(),this._textureViewHash[e.uid]}generateCanvas(e){const t=this._renderer,r=t.gpu.device.createCommandEncoder(),n=s["a"].get().createCanvas();n.width=e.source.pixelWidth,n.height=e.source.pixelHeight;const i=n.getContext("webgpu");return i.configure({device:t.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:navigator.gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),r.copyTextureToTexture({texture:t.texture.getGpuSource(e.source),origin:{x:0,y:0}},{texture:i.getCurrentTexture()},{width:n.width,height:n.height}),t.gpu.device.queue.submit([r.finish()]),n}getPixels(e){const t=this.generateCanvas(e),r=i["a"].getOptimalCanvasAndContext(t.width,t.height),s=r.context;s.drawImage(t,0,0);const{width:n,height:a}=t,o=s.getImageData(0,0,n,a),u=new Uint8ClampedArray(o.data.buffer);return i["a"].returnCanvasAndContext(r),{pixels:u,width:n,height:a}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null;for(const e of Object.keys(this._bindGroupHash)){const t=Number(e),r=this._bindGroupHash[t];null===r||void 0===r||r.destroy(),this._bindGroupHash[t]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}l.extension={type:[n["a"].WebGPUSystem],name:"texture"}},"4c24":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));const s={type:"image",upload(e,t,r){const s=e.resource;if(!s)return;const n=Math.min(t.width,e.resourceWidth||e.pixelWidth),i=Math.min(t.height,e.resourceHeight||e.pixelHeight),a="premultiply-alpha-on-upload"===e.alphaMode;r.device.queue.copyExternalImageToTexture({source:s},{texture:t,premultipliedAlpha:a},{width:n,height:i})}}},"4d46":function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));r("907a"),r("986a"),r("1d02"),r("3c5d"),r("1b3b"),r("3d71"),r("c6e3");var s=r("fa73"),n=r("2714"),i=r("3f4a"),a=r("c1ba"),o=r("8cbc"),u=r("0a79"),c=r("6f6c"),d=r("39bc"),h=r("3f58"),l=r("cb48"),p=r("3456");class f{init(){const e=new p["a"]({uTransformMatrix:{value:new n["a"],type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),t=Object(o["b"])({name:"graphics",bits:[u["a"],Object(c["a"])(a["a"]),d["c"],h["a"]]});this.shader=new l["a"]({gpuProgram:t,resources:{localUniforms:e}})}execute(e,t){const r=t.context,s=r.customShader||this.shader,n=e.renderer,a=n.graphicsContext,{geometry:o,instructions:u}=a.getContextRenderData(r),c=n.encoder;c.setPipelineFromGeometryProgramAndState(o,s.gpuProgram,e.state),c.setGeometry(o);const d=n.globalUniforms.bindGroup;c.setBindGroup(0,d,s.gpuProgram);const h=n.renderPipes.uniformBatch.getUniformBindGroup(s.resources.localUniforms,!0);c.setBindGroup(2,h,s.gpuProgram);const l=u.instructions;for(let p=0;p<u.instructionSize;p++){const e=l[p];if(s.groups[1]=e.bindGroup,!e.gpuBindGroup){const t=e.textures;e.bindGroup=Object(i["a"])(t.textures,t.count),e.gpuBindGroup=n.bindGroup.getBindGroup(e.bindGroup,s.gpuProgram,1)}c.setBindGroup(1,e.bindGroup,s.gpuProgram),c.renderPassEncoder.drawIndexed(e.size,1,e.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}f.extension={type:[s["a"].WebGPUPipesAdaptor],name:"graphics"}},"4f21":function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var s=r("fa73"),n=r("8cbc"),i=r("0a79"),a=r("6f6c"),o=r("3f58"),u=r("cb48"),c=r("07d6"),d=r("c1ba"),h=r("3f4a");const l=c["a"].for2d();class p{init(){const e=Object(n["b"])({name:"batch",bits:[i["a"],Object(a["a"])(d["a"]),o["a"]]});this._shader=new u["a"]({gpuProgram:e,groups:{}})}start(e,t){const r=e.renderer,s=r.encoder,n=this._shader.gpuProgram;this._geometry=t,s.setGeometry(t),l.blendMode="normal",r.pipeline.getPipeline(t,n,l);const i=r.globalUniforms.bindGroup;s.resetBindGroup(1),s.setBindGroup(0,i,n)}execute(e,t){const r=this._shader.gpuProgram,s=e.renderer,n=s.encoder;if(!t.bindGroup){const e=t.textures;t.bindGroup=Object(h["a"])(e.textures,e.count)}l.blendMode=t.blendMode;const i=s.bindGroup.getBindGroup(t.bindGroup,r,1),a=s.pipeline.getPipeline(this._geometry,r,l);t.bindGroup._touch(s.textureGC.count),n.setPipeline(a),n.renderPassEncoder.setBindGroup(1,i),n.renderPassEncoder.drawIndexed(t.size,1,t.start)}destroy(){this._shader.destroy(!0),this._shader=null}}p.extension={type:[s["a"].WebGPUPipesAdaptor],name:"batch"}},"51a6":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r("907a"),r("986a"),r("1d02"),r("3c5d"),r("1b3b"),r("3d71"),r("c6e3"),r("d9e2");class s{constructor(e){let{minUniformOffsetAlignment:t}=e;this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=t,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(e){if(e>this._minUniformOffsetAlignment/4)throw new Error("UniformBufferBatch: array is too large: "+4*e);const t=this.byteIndex;let r=t+4*e;if(r=Math.ceil(r/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,r>4*this.data.length)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=r,t}addGroup(e){const t=this.addEmptyGroup(e.length);for(let r=0;r<e.length;r++)this.data[t/4+r]=e[r];return t}destroy(){this._buffer.destroy(),this._buffer=null,this.data=null}}},6419:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("14d9");var s=r("536a"),n=r("c103");class i{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,t){const r=s["a"].get().createCanvas();r.width=e,r.height=t;const n=r.getContext("2d");return{canvas:r,context:n}}getOptimalCanvasAndContext(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e=Math.ceil(e*r-1e-6),t=Math.ceil(t*r-1e-6),e=Object(n["b"])(e),t=Object(n["b"])(t);const s=(e<<17)+(t<<1);this._canvasPool[s]||(this._canvasPool[s]=[]);let i=this._canvasPool[s].pop();return i||(i=this._createCanvasAndContext(e,t)),i}returnCanvasAndContext(e){const{width:t,height:r}=e.canvas,s=(t<<17)+(r<<1);this._canvasPool[s].push(e)}clear(){this._canvasPool={}}}const a=new i},"7ce4":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r("fa73"),n=r("07d6"),i=r("a6fc");class a{constructor(){this.defaultState=new n["a"],this.defaultState.blend=!0}contextChange(e){this.gpu=e}getColorTargets(e){const t=i["a"][e.blendMode]||i["a"].normal;return[{format:"bgra8unorm",writeMask:0,blend:t}]}destroy(){this.gpu=null}}a.extension={type:[s["a"].WebGPUSystem],name:"state"}},"7fe5":function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));r("14d9");var s=r("fa73"),n=r("dd6c"),i=r("991a"),a=r("1103"),o=r("51a6"),u=r("45d1c");const c=128;class d{constructor(e){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=e,this._batchBuffer=new o["a"]({minUniformOffsetAlignment:c});const t=256/c;for(let r=0;r<t;r++){let e=a["a"].UNIFORM|a["a"].COPY_DST;0===r&&(e|=a["a"].COPY_SRC),this._buffers.push(new n["a"]({data:this._batchBuffer.data,usage:e}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const e in this._bindGroupHash)this._bindGroupHash[e]=null;this._batchBuffer.clear()}getUniformBindGroup(e,t){if(!t&&this._bindGroupHash[e.uid])return this._bindGroupHash[e.uid];this._renderer.ubo.ensureUniformGroup(e);const r=e.buffer.data,s=this._batchBuffer.addEmptyGroup(r.length);return this._renderer.ubo.syncUniformGroup(e,this._batchBuffer.data,s/4),this._bindGroupHash[e.uid]=this._getBindGroup(s/c),this._bindGroupHash[e.uid]}getUboResource(e){this._renderer.ubo.updateUniformGroup(e);const t=e.buffer.data,r=this._batchBuffer.addGroup(t);return this._getBufferResource(r/c)}getArrayBindGroup(e){const t=this._batchBuffer.addGroup(e);return this._getBindGroup(t/c)}getArrayBufferResource(e){const t=this._batchBuffer.addGroup(e),r=t/c;return this._getBufferResource(r)}_getBufferResource(e){if(!this._bufferResources[e]){const t=this._buffers[e%2];this._bufferResources[e]=new i["a"]({buffer:t,offset:256*(e/2|0),size:c})}return this._bufferResources[e]}_getBindGroup(e){if(!this._bindGroups[e]){const t=new u["a"]({0:this._getBufferResource(e)});this._bindGroups[e]=t}return this._bindGroups[e]}_uploadBindGroups(){const e=this._renderer.buffer,t=this._buffers[0];t.update(this._batchBuffer.byteIndex),e.updateBuffer(t);const r=this._renderer.gpu.device.createCommandEncoder();for(let s=1;s<this._buffers.length;s++){const n=this._buffers[s];r.copyBufferToBuffer(e.getGPUBuffer(t),c,e.getGPUBuffer(n),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([r.finish()])}destroy(){for(let e=0;e<this._bindGroups.length;e++)this._bindGroups[e].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers=null;for(let e=0;e<this._bufferResources.length;e++)this._bufferResources[e].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}d.extension={type:[s["a"].WebGPUPipes],name:"uniformBatch"}},8722:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("fa73");class n{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.pipeline.setColorMask(e))}destroy(){this._renderer=null,this._colorMaskCache=null}}n.extension={type:[s["a"].WebGPUSystem],name:"colorMask"}},"969b":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));const s={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},n={blockBytes:4,blockWidth:1,blockHeight:1},i={type:"compressed",upload(e,t,r){let i=e.pixelWidth,a=e.pixelHeight;const o=s[e.format]||n;for(let s=0;s<e.resource.length;s++){const n=e.resource[s],u=Math.ceil(i/o.blockWidth)*o.blockBytes;r.device.queue.writeTexture({texture:t,mipLevel:s},n,{offset:0,bytesPerRow:u},{width:Math.ceil(i/o.blockWidth)*o.blockWidth,height:Math.ceil(a/o.blockHeight)*o.blockHeight,depthOrArrayLayers:1}),i=Math.max(i>>1,1),a=Math.max(a>>1,1)}}}},"9e64":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var s=r("fa73"),n=r("9ca7");class i{constructor(e){this._renderTargetStencilState=Object.create(null),this._renderer=e,e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:n["b"].DISABLED,stencilReference:0}),this._activeRenderTarget=e,this.setStencilMode(t.stencilMode,t.stencilReference)}setStencilMode(e,t){const r=this._renderTargetStencilState[this._activeRenderTarget.uid];r.stencilMode=e,r.stencilReference=t;const s=this._renderer;s.pipeline.setStencilMode(e),s.encoder.renderPassEncoder.setStencilReference(t)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}i.extension={type:[s["a"].WebGPUSystem],name:"stencil"}},a6fc:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));const s={normal:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},add:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},multiply:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},screen:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},overlay:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},none:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},"normal-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},"add-npm":{alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},"screen-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},erase:{alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}}}},c8c0:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("4c24");const n={type:"video",upload(e,t,r){s["a"].upload(e,t,r)}}},d65f:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r("ee68");function n(e,t){const{size:r,align:n}=s["a"][e.data.type],i=(n-r)/4;return`\n         v = uv.${e.data.name};\n         ${0!==t?`offset += ${t};`:""}\n\n         arrayOffset = offset;\n\n         t = 0;\n\n         for(var i=0; i < ${e.data.size*(r/4)}; i++)\n         {\n             for(var j = 0; j < ${r/4}; j++)\n             {\n                 data[arrayOffset++] = v[t++];\n             }\n             ${0!==i?`arrayOffset += ${i};`:""}\n         }\n     `}},ddea:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r("d9e2");class s{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(e){let t=this.pipelines[e];return t||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:"\n                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));\n\n                        struct VertexOutput {\n                        @builtin(position) position : vec4<f32>,\n                        @location(0) texCoord : vec2<f32>,\n                        };\n\n                        @vertex\n                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n                        var output : VertexOutput;\n                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n                        return output;\n                        }\n\n                        @group(0) @binding(0) var imgSampler : sampler;\n                        @group(0) @binding(1) var img : texture_2d<f32>;\n\n                        @fragment\n                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n                        return textureSample(img, imgSampler, texCoord);\n                        }\n                    "})),t=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=t),t}generateMipmap(e){const t=this._getMipmapPipeline(e.format);if("3d"===e.dimension||"1d"===e.dimension)throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=e;const s=e.depthOrArrayLayers||1,n=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!n){const t={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:s},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};r=this.device.createTexture(t)}const i=this.device.createCommandEncoder({}),a=t.getBindGroupLayout(0);for(let o=0;o<s;++o){let s=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:o,arrayLayerCount:1}),u=n?1:0;for(let n=1;n<e.mipLevelCount;++n){const e=r.createView({baseMipLevel:u++,mipLevelCount:1,dimension:"2d",baseArrayLayer:o,arrayLayerCount:1}),n=i.beginRenderPass({colorAttachments:[{view:e,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),c=this.device.createBindGroup({layout:a,entries:[{binding:0,resource:this.sampler},{binding:1,resource:s}]});n.setPipeline(t),n.setBindGroup(0,c),n.draw(3,1,0,0),n.end(),s=e}}if(!n){const t={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:s};for(let s=1;s<e.mipLevelCount;++s)i.copyTextureToTexture({texture:r,mipLevel:s-1},{texture:e,mipLevel:s},t),t.width=Math.ceil(t.width/2),t.height=Math.ceil(t.height/2)}return this.device.queue.submit([i.finish()]),n||r.destroy(),e}}},df2c:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var s=r("55b0"),n=r("160d"),i=r("8591"),a=r("f0a6");class o{init(e,t){this._renderer=e,this._renderTargetSystem=t}copyToTexture(e,t,r,s,n){const i=this._renderer,a=this._getGpuColorTexture(e),o=i.texture.getGpuSource(t.source);return i.encoder.commandEncoder.copyTextureToTexture({texture:a,origin:r},{texture:o,origin:n},s),t}startRenderPass(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;const n=this._renderTargetSystem,i=n.getGpuRenderTarget(e),a=this.getDescriptor(e,t,r);i.descriptor=a,this._renderer.pipeline.setRenderTarget(i),this._renderer.encoder.beginRenderPass(i),this._renderer.encoder.setViewport(s)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);return t.contexts[0]?t.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(e.colorTextures[0].source)}getDescriptor(e,t,r){"boolean"===typeof t&&(t=t?s["a"].ALL:s["a"].NONE);const n=this._renderTargetSystem,i=n.getGpuRenderTarget(e),a=e.colorTextures.map((e,a)=>{var o;const u=i.contexts[a];let c,d;if(u){const e=u.getCurrentTexture(),t=e.createView();c=t}else c=this._renderer.texture.getGpuSource(e).createView({mipLevelCount:1});i.msaaTextures[a]&&(d=c,c=this._renderer.texture.getTextureView(i.msaaTextures[a]));const h=t&s["a"].COLOR?"clear":"load";return null!==(o=r)&&void 0!==o||(r=n.defaultClearColor),{view:c,resolveTarget:d,clearValue:r,storeOp:"store",loadOp:h}});let o;if(!e.stencil&&!e.depth||e.depthStencilTexture||(e.ensureDepthStencilTexture(),e.depthStencilTexture.source.sampleCount=i.msaa?4:1),e.depthStencilTexture){const r=t&s["a"].STENCIL?"clear":"load",n=t&s["a"].DEPTH?"clear":"load";o={view:this._renderer.texture.getGpuSource(e.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:r,depthClearValue:1,depthLoadOp:n,depthStoreOp:"store"}}const u={colorAttachments:a,depthStencilAttachment:o};return u}clear(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!t)return;const{gpu:n,encoder:i}=this._renderer,a=n.device,o=null===i.commandEncoder;if(o){const n=a.createCommandEncoder(),i=this.getDescriptor(e,t,r),o=n.beginRenderPass(i);o.setViewport(s.x,s.y,s.width,s.height,0,1),o.end();const u=n.finish();a.queue.submit([u])}else this.startRenderPass(e,t,r,s)}initGpuRenderTarget(e){e.isRoot=!0;const t=new a["a"];return e.colorTextures.forEach((e,r)=>{if(n["a"].test(e.resource)){const n=e.resource.getContext("webgpu"),i=e.transparent?"premultiplied":"opaque";try{n.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:i})}catch(s){console.error(s)}t.contexts[r]=n}if(t.msaa=e.source.antialias,e.source.antialias){const e=new i["a"]({width:0,height:0,sampleCount:4});t.msaaTextures[r]=e}}),t.msaa&&(t.msaaSamples=4,e.depthStencilTexture&&(e.depthStencilTexture.source.sampleCount=4)),t}destroyGpuRenderTarget(e){e.contexts.forEach(e=>{e.unconfigure()}),e.msaaTextures.forEach(e=>{e.destroy()}),e.msaaTextures.length=0,e.contexts.length=0}ensureDepthStencilTexture(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);e.depthStencilTexture&&t.msaa&&(e.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);t.width=e.width,t.height=e.height,t.msaa&&e.colorTextures.forEach((e,r)=>{const s=t.msaaTextures[r];null===s||void 0===s||s.resize(e.source.width,e.source.height,e.source._resolution)})}}},df65:function(e,t,r){"use strict";r.r(t),r.d(t,"WebGPURenderer",(function(){return U}));var s=r("fa73"),n=r("4d46"),i=r("1bb9"),a=r("4f21"),o=r("3969"),u=r("4925"),c=r("fd09"),d=r("0578"),h=r("0696"),l=r("8722"),p=r("190b"),f=r("2e80"),g=r("9e64"),m=r("1f8f"),_=r("7fe5"),b=r("f844"),x=r("2954"),y=r("30b4"),G=r("7ce4"),P=r("3d33");const v=[...u["b"],m["a"],f["a"],p["a"],h["a"],P["a"],x["a"],y["a"],G["a"],b["a"],l["a"],g["a"],d["a"]],B=[...u["a"],_["a"]],S=[a["a"],i["a"],n["a"]],T=[],C=[],w=[];s["b"].handleByNamedList(s["a"].WebGPUSystem,T),s["b"].handleByNamedList(s["a"].WebGPUPipes,C),s["b"].handleByNamedList(s["a"].WebGPUPipesAdaptor,w),s["b"].add(...v,...B,...S);class U extends o["a"]{constructor(){const e={name:"webgpu",type:c["a"].WEBGPU,systems:T,renderPipes:C,renderPipeAdaptors:w};super(e)}}},e3db:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));const s={type:"image",upload(e,t,r){const s=e.resource,n=(0|e.pixelWidth)*(0|e.pixelHeight),i=s.byteLength/n;r.device.queue.writeTexture({texture:t},s,{offset:0,rowsPerImage:e.pixelHeight,bytesPerRow:e.pixelHeight*i},{width:e.pixelWidth,height:e.pixelHeight,depthOrArrayLayers:1})}}},ee68:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));r("d9e2");const s={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function n(e){const t=e.map(e=>({data:e,offset:0,size:0}));let r=0;for(let n=0;n<t.length;n++){const e=t[n];let i=s[e.data.type].size;const a=s[e.data.type].align;if(!s[e.data.type])throw new Error("[Pixi.js] WebGPU UniformBuffer: Unknown type "+e.data.type);e.data.size>1&&(i=Math.max(i,a)*e.data.size),r=Math.ceil(r/a)*a,e.size=i,e.offset=r,r+=i}return r=16*Math.ceil(r/16),{uboElements:t,size:r}}},f0a6:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}},f844:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));r("14d9");var s=r("fa73"),n=r("dcb4"),i=r("9ca7"),a=r("7eb3"),o=r("d12d");const u={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};function c(e,t,r,s,n){return e<<24|t<<16|r<<10|s<<5|n}function d(e,t,r,s){return r<<6|e<<3|s<<1|t}class h{constructor(e){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=e}contextChange(e){this._gpu=e,this.setStencilMode(i["b"].DISABLED),this._updatePipeHash()}setMultisampleCount(e){this._multisampleCount!==e&&(this._multisampleCount=e,this._updatePipeHash())}setRenderTarget(e){this._multisampleCount=e.msaaSamples,this._depthStencilAttachment=e.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(e){this._colorMask!==e&&(this._colorMask=e,this._updatePipeHash())}setStencilMode(e){this._stencilMode!==e&&(this._stencilMode=e,this._stencilState=o["a"][e],this._updatePipeHash())}setPipeline(e,t,r,s){const n=this.getPipeline(e,t,r);s.setPipeline(n)}getPipeline(e,t,r,s){e._layoutKey||(Object(n["a"])(e,t.attributeData),this._generateBufferKey(e)),s=s||e.topology;const i=c(e._layoutKey,t._layoutKey,r.data,r._blendModeId,u[s]);return this._pipeCache[i]||(this._pipeCache[i]=this._createPipeline(e,t,r,s)),this._pipeCache[i]}_createPipeline(e,t,r,s){const n=this._gpu.device,a=this._createVertexBufferLayouts(e),o=this._renderer.state.getColorTargets(r);o[0].writeMask=this._stencilMode===i["b"].RENDERING_MASK_ADD?0:this._colorMask;const u=this._renderer.shader.getProgramData(t).pipeline,c={vertex:{module:this._getModule(t.vertex.source),entryPoint:t.vertex.entryPoint,buffers:a},fragment:{module:this._getModule(t.fragment.source),entryPoint:t.fragment.entryPoint,targets:o},primitive:{topology:s,cullMode:r.cullMode},layout:u,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};this._depthStencilAttachment&&(c.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:r.depthTest,depthCompare:r.depthTest?"less":"always"});const d=n.createRenderPipeline(c);return d}_getModule(e){return this._moduleCache[e]||this._createModule(e)}_createModule(e){const t=this._gpu.device;return this._moduleCache[e]=t.createShaderModule({code:e}),this._moduleCache[e]}_generateBufferKey(e){const t=[];let r=0;const s=Object.keys(e.attributes).sort();for(let i=0;i<s.length;i++){const n=e.attributes[s[i]];t[r++]=n.location,t[r++]=n.offset,t[r++]=n.format,t[r++]=n.stride}const n=t.join("");return e._layoutKey=Object(a["a"])(n,"geometry"),e._layoutKey}_createVertexBufferLayouts(e){if(this._bufferLayoutsCache[e._layoutKey])return this._bufferLayoutsCache[e._layoutKey];const t=[];return e.buffers.forEach(r=>{const s={arrayStride:0,stepMode:"vertex",attributes:[]},n=s.attributes;for(const t in e.attributes){const i=e.attributes[t];i.buffer===r&&(s.arrayStride=i.stride,s.stepMode=i.instance?"instance":"vertex",n.push({shaderLocation:i.location,offset:i.offset,format:i.format}))}n.length&&t.push(s)}),this._bufferLayoutsCache[e._layoutKey]=t,t}_updatePipeHash(){const e=d(this._stencilMode,this._multisampleCount,this._colorMask,this._depthStencilAttachment);this._pipeStateCaches[e]||(this._pipeStateCaches[e]=Object.create(null)),this._pipeCache=this._pipeStateCaches[e]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}h.extension={type:[s["a"].WebGPUSystem],name:"pipeline"}}}]);
//# sourceMappingURL=chunk-44869a72.b8ee09aa.js.map